/**
 * =================================================================
 * МОДУЛЬ: ЛОГИКА СКРОЛЛА
 * ФАЙЛ: js/scroll.js
 * ОПИСАНИЕ: Добавляет класс .scrolled к хедеру при прокрутке.
 * Оптимизирован через requestAnimationFrame (Throttling) для 60FPS.
 * =================================================================
 */

(function () {
    'use strict';

    // 1. ПОИСК ЭЛЕМЕНТОВ
    const header = document.querySelector('header');
    
    // Порог (в пикселях), после которого хедер меняет стиль.
    // 1px означает, что эффект сработает сразу, как только пользователь начнет скроллить.
    const scrollThreshold = 40; 

    // Флаг "занят ли браузер". 
    // Нужен, чтобы не запускать функцию обновления слишком часто.
    let isTicking = false;     

    // GUARD CLAUSE
    // Если хедера нет на странице, выходим.
    if (!header) return;

    /**
     * Основная функция обновления стилей.
     * Именно она делает "тяжелую" работу (добавляет/удаляет классы).
     * Вызывается браузером в оптимальный момент времени (перед перерисовкой кадра).
     */
    function updateHeader() {
        // window.scrollY - текущая позиция скролла сверху
        if (window.scrollY > scrollThreshold) {
            header.classList.add('scrolled');
        } else {
            header.classList.remove('scrolled');
        }
        
        // Сбрасываем флаг, разрешая обрабатывать следующие события скролла
        isTicking = false;
    }

    // 2. СЛУШАТЕЛЬ СОБЫТИЙ (ОПТИМИЗИРОВАННЫЙ)
    window.addEventListener('scroll', () => {
        // Если флаг isTicking == true, значит предыдущий кадр еще не отрисован.
        // Мы просто игнорируем это событие scroll, чтобы не перегружать процессор.
        if (!isTicking) {
            // Просим браузер: "Как будешь готов рисовать следующий кадр, запусти updateHeader"
            window.requestAnimationFrame(updateHeader);
            
            // Ставим флаг "Занято"
            isTicking = true;
        }
    });
})();